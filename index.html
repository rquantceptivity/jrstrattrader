<!DOCTYPE html>
<html>
<head>
  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
<h2 align="center"> JR Strategy Backtester </h2>

<!-- Begin JavaScript --------------------------------------->


<script>
//------- On load, focus on Date
window.onload = function() {
   document.getElementById('date').focus();
}


//--------- Create object of arrays for tickers for ETFs and Futures
var ticker_list =
{       
      DomETF   : ['SPY','GLD'],
      ForETF    : ['EEM','FXI']
};


//-------function to display array of tickers based on security selection

function ChooseTicker()
{
    var selection = document.getElementById('sl').value;
    var new_list = ticker_list[selection];
    
    document.getElementById('ts').length = 0;
    
    var dummyOption = new Option('Select a Ticker','none',true,true);
   
    document.getElementById('ts').options[0] = dummyOption;
 
    for(var i = 0; i < new_list.length; i++)
    {
      var ticker = new_list[i];
      var opt = new Option(ticker,ticker,false,false);
      document.getElementById('ts').options[i+1] = opt;
    }
}



var num_diag = 2;


</script>


<form name='calen' id='cal' method=GET onSubmit='return formValidation()' align='center'>
<table align="center">
<tr>
<td><b> Select a Date <td ><input type="date" id='date' name="date" min='2018-01-01' max='2030-01-01' required pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}">
</tr>
</table>
</form>
<br>

<form  align='center'>
<table align="center">

<td><b>Type of Security <td ><select name='sl' id='sl' size=2 onChange='return ChooseTicker();'>
                                
                                <option value='DomETF'> Domestic ETF </option>
                                <option value='ForETF'> Foreign ETF </option>
                             </select>
                             <br>
                             <select name='ts' id='ts' size = 1 onChange='return plot_data();'>
                                <option selected>--------Ticker----------</option>
                             </select>

</table>
</form>




<body>
  <div id="graph"></div>
</body>


<script>
//--------------get today's date
var today = new Date();
var dd = today.getDate();
var mm = today.getMonth()+1; //January is 0!
var yyyy = today.getFullYear();

if(dd<10) {
    dd = '0'+ dd
} 

if(mm<10) {
    mm = '0'+mm
} 

today = yyyy + '-' + mm + '-' + dd;
document.getElementById('date').value = today;
</script>


<script>



plot_data = function()
{
//BUILD URL FROM INPUTTED TICKER
Plotly.purge('graph');
url = 'https://raw.githubusercontent.com/rquantceptivity/Data/master/' + document.getElementById('ts').value + '.csv'


Plotly.d3.csv(url, function(err, rows)
{

function unpack(rows, key) {
  return rows.map(function(row) {
    return row[key];
  });
}

var trace = {
  x: unpack(rows, 'Date'),
  close: unpack(rows, 'Close'),
  high: unpack(rows, 'High'),
  low: unpack(rows, 'Low'),
  open: unpack(rows, 'Open'),
  
  // customize colors
  increasing: {line: {color: 'black'}},
  decreasing: {line: {color: 'red'}},

  type: 'ohlc',
  xaxis: 'x',
  yaxis: 'y'
};


var num_hor = 10;


for(var i = 1; i < num_hor+1; i++)
{
     var col_nam = 'h' + i;
     h_out_tmp ={
       x: unpack(rows, 'Date'),
       y: unpack(rows, col_nam), mode:'lines',
          width:1,
          line: {
          color: 'black'
           },
          type: 'line'
          };
        var st = 'trace_hor' + i + '=' + 'h_out_tmp';
        eval(st);
         
      
};



var data = [trace,trace_hor1,trace_hor2,trace_hor3,trace_hor4,trace_hor5, trace_hor6, trace_hor7, trace_hor8, trace_hor9, trace_hor10];


var layout = {
  width: 2000,
  height: 1000,
  dragmode: 'zoom',
  showlegend: true,
  xaxis: {
    rangeslider: {
         visible: true
     }
  }
};

Plotly.plot('graph', data, layout);
})
};

</script>





<!-- End JavaScript ----------------------------------------->

</body>
</html>

